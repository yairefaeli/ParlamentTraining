/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { GeoUtilsService } from '../angular-cesium/services/geo-utils/geo-utils.service';
import * as h337 from 'heatmap.js/build/heatmap.js';
import { Injectable } from '@angular/core';
// Consider moving to a different package.
if (!h337) {
    throw new Error('must install heatmap.js. please do npm -i heatmap.js ');
}
/**
 * @record
 */
export function Rectangle() { }
if (false) {
    /** @type {?} */
    Rectangle.prototype.west;
    /** @type {?} */
    Rectangle.prototype.south;
    /** @type {?} */
    Rectangle.prototype.east;
    /** @type {?} */
    Rectangle.prototype.north;
}
/**
 *  x: lon
 *  y: lat
 *  value: point value
 * @record
 */
export function HeatPointDataPoint() { }
if (false) {
    /** @type {?} */
    HeatPointDataPoint.prototype.x;
    /** @type {?} */
    HeatPointDataPoint.prototype.y;
    /** @type {?} */
    HeatPointDataPoint.prototype.value;
}
/**
 *   min:  the minimum allowed value for the data values
 *  max:  the maximum allowed value for the data values
 *  heatPointsData: an array of data points in WGS84 coordinates and values like { x:lon, y:lat, value)
 * @record
 */
export function HeatmapDataSet() { }
if (false) {
    /** @type {?|undefined} */
    HeatmapDataSet.prototype.min;
    /** @type {?|undefined} */
    HeatmapDataSet.prototype.max;
    /** @type {?} */
    HeatmapDataSet.prototype.heatPointsData;
}
/**
 * a heatmap.js options object (see http://www.patrick-wied.at/static/heatmapjs/docs.html#h337-create)
 * @record
 */
export function HeatMapOptions() { }
if (false) {
    /** @type {?|undefined} */
    HeatMapOptions.prototype.gradient;
    /** @type {?|undefined} */
    HeatMapOptions.prototype.radius;
    /** @type {?|undefined} */
    HeatMapOptions.prototype.opacity;
    /** @type {?|undefined} */
    HeatMapOptions.prototype.maxOpacity;
    /** @type {?|undefined} */
    HeatMapOptions.prototype.minOpacity;
    /** @type {?|undefined} */
    HeatMapOptions.prototype.blur;
    /* Skipping unhandled member: [propName: string]: any;*/
}
/**
 * Create heatmap material (Cesium.ImageMaterialProperty with heatmap as the image)
 * works with http://www.patrick-wied.at/static/heatmapjs. must do npm -i heatmap.js
 * usage:
 * ```
 *
 * const mCreator = new CesiumHeatMapMaterialCreator();
 * const containingRect = CesiumHeatMapMaterialCreator.calcCircleContainingRect(this.circleCenter, this.circleRadius);
 * const userHeatmapOptions = {
 * radius : 2000,
 * minOpacity : 0,
 * maxOpacity : 0.9,
 * } as any;
 * this.circleHeatMapMaterial = mCreator.create(containingRect, {
 * heatPointsData : [
 * {
 * x : -100.0,
 * y : 24.0,
 * value : 95
 * }
 * ],
 * min : 0,
 * max : 100,
 * }, userHeatmapOptions);
 * ```
 *
 * inspired by https://github.com/danwild/CesiumHeatmap
 */
export class CesiumHeatMapMaterialCreator {
    constructor() {
        this.heatmapOptionsDefaults = {
            minCanvasSize: 700,
            // minimum size (in pixels) for the heatmap canvas
            maxCanvasSize: 2000,
            // maximum size (in pixels) for the heatmap canvas
            radiusFactor: 60,
            // data point size factor used if no radius is given
            // (the greater of height and width divided by this number yields the used radius)
            spacingFactor: 1,
            // extra space around the borders (point radius multiplied by this number yields the spacing)
            maxOpacity: 0.8,
            // the maximum opacity used if not given in the heatmap options object
            minOpacity: 0.1,
            // the minimum opacity used if not given in the heatmap options object
            blur: 0.85,
            // the blur used if not given in the heatmap options object
            gradient: {
                // the gradient used if not given in the heatmap options object
                '.3': 'blue',
                '.65': 'yellow',
                '.8': 'orange',
                '.95': 'red'
            },
        };
        this.WMP = new Cesium.WebMercatorProjection();
        /**
         * Convert a WGS84 location to the corresponding heatmap location
         *
         *  p: a WGS84 location like {x:lon, y:lat}
         */
        this.wgs84PointToHeatmapPoint = function (p) {
            return this.mercatorPointToHeatmapPoint(this.wgs84ToMercator(p));
        };
        this.rad2deg = function (r) {
            /** @type {?} */
            const d = r / (Math.PI / 180.0);
            return d;
        };
    }
    /**
     *
     * @param {?} center - Cartesian3
     * @param {?} radius - Meters
     * @return {?}
     */
    static calcCircleContainingRect(center, radius) {
        return CesiumHeatMapMaterialCreator.calcEllipseContainingRect(center, radius, radius);
    }
    /**
     *
     * @param {?} center - Cartesian3
     * @param {?} semiMajorAxis - meters
     * @param {?} semiMinorAxis - meters
     * @return {?}
     */
    static calcEllipseContainingRect(center, semiMajorAxis, semiMinorAxis) {
        /** @type {?} */
        const top = GeoUtilsService.pointByLocationDistanceAndAzimuth(center, semiMinorAxis, 0, true);
        /** @type {?} */
        const right = GeoUtilsService.pointByLocationDistanceAndAzimuth(center, semiMajorAxis, Math.PI / 2, true);
        /** @type {?} */
        const bottom = GeoUtilsService.pointByLocationDistanceAndAzimuth(center, semiMajorAxis, Math.PI, true);
        /** @type {?} */
        const left = GeoUtilsService.pointByLocationDistanceAndAzimuth(center, semiMajorAxis, Math.PI * 1.5, true);
        /** @type {?} */
        const ellipsePoints = [top, right, bottom, left];
        return Cesium.Rectangle.fromCartesianArray(ellipsePoints);
    }
    /**
     *
     * @param {?} points Cartesian3
     * @return {?}
     */
    static calculateContainingRectFromPoints(points) {
        return Cesium.Rectangle.fromCartesianArray(points);
    }
    /**
     * Set an array of heatmap locations
     *
     *  min:  the minimum allowed value for the data values
     *  max:  the maximum allowed value for the data values
     *  data: an array of data points in heatmap coordinates and values like {x, y, value}
     * @param {?} min
     * @param {?} max
     * @param {?} data
     * @return {?}
     */
    setData(min, max, data) {
        if (data && data.length > 0 && min !== null && min !== false && max !== null && max !== false) {
            this.heatmap.setData({
                min: min,
                max: max,
                data: data
            });
            return true;
        }
        return false;
    }
    /**
     * Set an array of WGS84 locations
     *
     *  min:  the minimum allowed value for the data values
     *  max:  the maximum allowed value for the data values
     *  data: an array of data points in WGS84 coordinates and values like { x:lon, y:lat, value }
     * @private
     * @param {?} min
     * @param {?} max
     * @param {?} data
     * @return {?}
     */
    setWGS84Data(min, max, data) {
        if (data && data.length > 0 && min !== null && min !== false && max !== null && max !== false) {
            /** @type {?} */
            const convdata = [];
            for (let i = 0; i < data.length; i++) {
                /** @type {?} */
                const gp = data[i];
                /** @type {?} */
                const hp = this.wgs84PointToHeatmapPoint(gp);
                if (gp.value || gp.value === 0) {
                    hp.value = gp.value;
                }
                convdata.push(hp);
            }
            return this.setData(min, max, convdata);
        }
        return false;
    }
    /**
     * Convert a mercator location to the corresponding heatmap location
     *
     *  p: a WGS84 location like {x: lon, y:lat}
     * @private
     * @param {?} p
     * @return {?}
     */
    mercatorPointToHeatmapPoint(p) {
        /** @type {?} */
        const pn = {};
        pn.x = Math.round((p.x - this._xoffset) / this._factor + this._spacing);
        pn.y = Math.round((p.y - this._yoffset) / this._factor + this._spacing);
        pn.y = this.height - pn.y;
        return pn;
    }
    /**
     * @private
     * @param {?} height
     * @param {?} width
     * @return {?}
     */
    createContainer(height, width) {
        /** @type {?} */
        const id = 'heatmap' + CesiumHeatMapMaterialCreator.containerCanvasCounter++;
        /** @type {?} */
        const container = document.createElement('div');
        container.setAttribute('id', id);
        container.setAttribute('style', 'width: ' + width + 'px; height: ' + height + 'px; margin: 0px; display: none;');
        document.body.appendChild(container);
        return { container, id };
    }
    /**
     * Convert a WGS84 location into a mercator location
     *
     *  p: the WGS84 location like {x: lon, y: lat}
     * @private
     * @param {?} p
     * @return {?}
     */
    wgs84ToMercator(p) {
        /** @type {?} */
        const mp = this.WMP.project(Cesium.Cartographic.fromDegrees(p.x, p.y));
        return {
            x: mp.x,
            y: mp.y
        };
    }
    /**
     * Convert a WGS84 bounding box into a mercator bounding box*
     *  bb: the WGS84 bounding box like {north, east, south, west}
     * @private
     * @param {?} bb
     * @return {?}
     */
    wgs84ToMercatorBB(bb) {
        // TODO validate rad or deg
        /** @type {?} */
        const sw = this.WMP.project(Cesium.Cartographic.fromRadians(bb.west, bb.south));
        /** @type {?} */
        const ne = this.WMP.project(Cesium.Cartographic.fromRadians(bb.east, bb.north));
        return {
            north: ne.y,
            east: ne.x,
            south: sw.y,
            west: sw.x
        };
    }
    /**
     * Convert a mercator bounding box into a WGS84 bounding box
     *
     *  bb: the mercator bounding box like {north, east, south, west}
     * @private
     * @param {?} bb
     * @return {?}
     */
    mercatorToWgs84BB(bb) {
        /** @type {?} */
        const sw = this.WMP.unproject(new Cesium.Cartesian3(bb.west, bb.south));
        /** @type {?} */
        const ne = this.WMP.unproject(new Cesium.Cartesian3(bb.east, bb.north));
        return {
            north: this.rad2deg(ne.latitude),
            east: this.rad2deg(ne.longitude),
            south: this.rad2deg(sw.latitude),
            west: this.rad2deg(sw.longitude)
        };
    }
    /**
     * @private
     * @param {?} mbb
     * @return {?}
     */
    setWidthAndHeight(mbb) {
        this.width = ((mbb.east > 0 && mbb.west < 0) ? mbb.east + Math.abs(mbb.west) : Math.abs(mbb.east - mbb.west));
        this.height = ((mbb.north > 0 && mbb.south < 0) ? mbb.north + Math.abs(mbb.south) : Math.abs(mbb.north - mbb.south));
        this._factor = 1;
        if (this.width > this.height && this.width > this.heatmapOptionsDefaults.maxCanvasSize) {
            this._factor = this.width / this.heatmapOptionsDefaults.maxCanvasSize;
            if (this.height / this._factor < this.heatmapOptionsDefaults.minCanvasSize) {
                this._factor = this.height / this.heatmapOptionsDefaults.minCanvasSize;
            }
        }
        else if (this.height > this.width && this.height > this.heatmapOptionsDefaults.maxCanvasSize) {
            this._factor = this.height / this.heatmapOptionsDefaults.maxCanvasSize;
            if (this.width / this._factor < this.heatmapOptionsDefaults.minCanvasSize) {
                this._factor = this.width / this.heatmapOptionsDefaults.minCanvasSize;
            }
        }
        else if (this.width < this.height && this.width < this.heatmapOptionsDefaults.minCanvasSize) {
            this._factor = this.width / this.heatmapOptionsDefaults.minCanvasSize;
            if (this.height / this._factor > this.heatmapOptionsDefaults.maxCanvasSize) {
                this._factor = this.height / this.heatmapOptionsDefaults.maxCanvasSize;
            }
        }
        else if (this.height < this.width && this.height < this.heatmapOptionsDefaults.minCanvasSize) {
            this._factor = this.height / this.heatmapOptionsDefaults.minCanvasSize;
            if (this.width / this._factor > this.heatmapOptionsDefaults.maxCanvasSize) {
                this._factor = this.width / this.heatmapOptionsDefaults.maxCanvasSize;
            }
        }
        this.width = this.width / this._factor;
        this.height = this.height / this._factor;
    }
    /**
     * containingBoundingRect: Cesium.Rectangle like {north, east, south, west}
     * min:  the minimum allowed value for the data values
     * max:  the maximum allowed value for the data values
     * datapoint: {x,y,value}
     * heatmapOptions: a heatmap.js options object (see http://www.patrick-wied.at/static/heatmapjs/docs.html#h337-create)
     *
     * @param {?} containingBoundingRect
     * @param {?} heatmapDataSet
     * @param {?} heatmapOptions
     * @return {?}
     */
    create(containingBoundingRect, heatmapDataSet, heatmapOptions) {
        /** @type {?} */
        const userBB = containingBoundingRect;
        const { heatPointsData, min = 0, max = 100 } = heatmapDataSet;
        /** @type {?} */
        const finalHeatmapOptions = Object.assign({}, this.heatmapOptionsDefaults, heatmapOptions);
        this._mbounds = this.wgs84ToMercatorBB(userBB);
        this.setWidthAndHeight(this._mbounds);
        finalHeatmapOptions.radius = Math.round((heatmapOptions.radius) ?
            heatmapOptions.radius : ((this.width > this.height) ?
            this.width / this.heatmapOptionsDefaults.radiusFactor :
            this.height / this.heatmapOptionsDefaults.radiusFactor));
        this._spacing = finalHeatmapOptions.radius * this.heatmapOptionsDefaults.spacingFactor;
        this._xoffset = this._mbounds.west;
        this._yoffset = this._mbounds.south;
        this.width = Math.round(this.width + this._spacing * 2);
        this.height = Math.round(this.height + this._spacing * 2);
        this._mbounds.west -= this._spacing * this._factor;
        this._mbounds.east += this._spacing * this._factor;
        this._mbounds.south -= this._spacing * this._factor;
        this._mbounds.north += this._spacing * this._factor;
        this.bounds = this.mercatorToWgs84BB(this._mbounds);
        this._rectangle = Cesium.Rectangle.fromDegrees(this.bounds.west, this.bounds.south, this.bounds.east, this.bounds.north);
        const { container, id } = this.createContainer(this.height, this.width);
        Object.assign(finalHeatmapOptions, { container });
        this.heatmap = h337.create(finalHeatmapOptions);
        this.setWGS84Data(0, 100, heatPointsData);
        /** @type {?} */
        const heatMapCanvas = this.heatmap._renderer.canvas;
        /** @type {?} */
        const heatMapMaterial = new Cesium.ImageMaterialProperty({
            image: heatMapCanvas,
            transparent: true,
        });
        this.setClear(heatMapMaterial, id);
        return heatMapMaterial;
    }
    /**
     * @private
     * @param {?} heatMapMaterial
     * @param {?} id
     * @return {?}
     */
    setClear(heatMapMaterial, id) {
        heatMapMaterial.clear = () => {
            /** @type {?} */
            const elem = document.getElementById(id);
            return elem.parentNode.removeChild(elem);
        };
    }
}
CesiumHeatMapMaterialCreator.containerCanvasCounter = 0;
CesiumHeatMapMaterialCreator.decorators = [
    { type: Injectable }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    CesiumHeatMapMaterialCreator.containerCanvasCounter;
    /** @type {?} */
    CesiumHeatMapMaterialCreator.prototype.heatmapOptionsDefaults;
    /** @type {?} */
    CesiumHeatMapMaterialCreator.prototype.WMP;
    /** @type {?} */
    CesiumHeatMapMaterialCreator.prototype._spacing;
    /** @type {?} */
    CesiumHeatMapMaterialCreator.prototype.width;
    /** @type {?} */
    CesiumHeatMapMaterialCreator.prototype.height;
    /** @type {?} */
    CesiumHeatMapMaterialCreator.prototype._mbounds;
    /** @type {?} */
    CesiumHeatMapMaterialCreator.prototype.bounds;
    /** @type {?} */
    CesiumHeatMapMaterialCreator.prototype._factor;
    /** @type {?} */
    CesiumHeatMapMaterialCreator.prototype._rectangle;
    /** @type {?} */
    CesiumHeatMapMaterialCreator.prototype.heatmap;
    /** @type {?} */
    CesiumHeatMapMaterialCreator.prototype._xoffset;
    /** @type {?} */
    CesiumHeatMapMaterialCreator.prototype._yoffset;
    /**
     * Convert a WGS84 location to the corresponding heatmap location
     *
     *  p: a WGS84 location like {x:lon, y:lat}
     * @type {?}
     * @private
     */
    CesiumHeatMapMaterialCreator.prototype.wgs84PointToHeatmapPoint;
    /**
     * @type {?}
     * @private
     */
    CesiumHeatMapMaterialCreator.prototype.rad2deg;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2VzaXVtLWhlYXRtYXAtbWF0ZXJpYWwtY3JlYXRvci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FuZ3VsYXItY2VzaXVtLyIsInNvdXJjZXMiOlsibGliL2hlYXRtYXAvY2VzaXVtLWhlYXRtYXAtbWF0ZXJpYWwtY3JlYXRvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBRUEsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHdEQUF3RCxDQUFDO0FBQ3pGLE9BQU8sS0FBSyxJQUFJLE1BQU0sNkJBQTZCLENBQUM7QUFDcEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQzs7QUFJM0MsSUFBSSxDQUFDLElBQUksRUFBRTtJQUNULE1BQU0sSUFBSSxLQUFLLENBQUMsdURBQXVELENBQUMsQ0FBQztDQUMxRTs7OztBQUdELCtCQUtDOzs7SUFKQyx5QkFBYTs7SUFDYiwwQkFBYzs7SUFDZCx5QkFBYTs7SUFDYiwwQkFBYzs7Ozs7Ozs7QUFTaEIsd0NBSUM7OztJQUhDLCtCQUFVOztJQUNWLCtCQUFVOztJQUNWLG1DQUFjOzs7Ozs7OztBQVFoQixvQ0FJQzs7O0lBSEMsNkJBQWE7O0lBQ2IsNkJBQWE7O0lBQ2Isd0NBQXFDOzs7Ozs7QUFNdkMsb0NBU0M7OztJQU5DLGtDQUFlOztJQUNmLGdDQUFnQjs7SUFDaEIsaUNBQWlCOztJQUNqQixvQ0FBb0I7O0lBQ3BCLG9DQUFvQjs7SUFDcEIsOEJBQVc7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFpQ2IsTUFBTSxPQUFPLDRCQUE0QjtJQUR6QztRQU1FLDJCQUFzQixHQUFHO1lBQ3ZCLGFBQWEsRUFBRSxHQUFHOztZQUNsQixhQUFhLEVBQUUsSUFBSTs7WUFDbkIsWUFBWSxFQUFFLEVBQUU7OztZQUVoQixhQUFhLEVBQUUsQ0FBQzs7WUFDaEIsVUFBVSxFQUFFLEdBQUc7O1lBQ2YsVUFBVSxFQUFFLEdBQUc7O1lBQ2YsSUFBSSxFQUFFLElBQUk7O1lBQ1YsUUFBUSxFQUFFOztnQkFD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T0FBTyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsbUJBQW1CLENBQUMsQ0FBQztRQUdoRCxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsY0FBYyxDQUFDLENBQUM7O2NBQ3BDLGFBQWEsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxNQUFNOztjQUM3QyxlQUFlLEdBQUcsSUFBSSxNQUFNLENBQUMscUJBQXFCLENBQUM7WUFDdkQsS0FBSyxFQUFFLGFBQWE7WUFDcEIsV0FBVyxFQUFFLElBQUk7U0FDbEIsQ0FBQztRQUNGLElBQUksQ0FBQyxRQUFRLENBQUMsZUFBZSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBRW5DLE9BQU8sZUFBZSxDQUFDO0lBQ3pCLENBQUM7Ozs7Ozs7SUFFTyxRQUFRLENBQUMsZUFBb0IsRUFBRSxFQUFVO1FBQy9DLGVBQWUsQ0FBQyxLQUFLLEdBQUcsR0FBRyxFQUFFOztrQkFDckIsSUFBSSxHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFDO1lBQ3hDLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDM0MsQ0FBQyxDQUFDO0lBQ0osQ0FBQzs7QUEvU2MsbURBQXNCLEdBQUcsQ0FBQyxDQUFDOztZQUozQyxVQUFVOzs7Ozs7O0lBSVQsb0RBQTBDOztJQUUxQyw4REFlRTs7SUFFRiwyQ0FBeUM7O0lBQ3pDLGdEQUFpQjs7SUFDakIsNkNBQWM7O0lBQ2QsOENBQWU7O0lBQ2YsZ0RBQWM7O0lBQ2QsOENBQVk7O0lBQ1osK0NBQWdCOztJQUNoQixrREFBc0I7O0lBQ3RCLCtDQUFhOztJQUNiLGdEQUFjOztJQUNkLGdEQUFjOzs7Ozs7OztJQXlIZCxnRUFFRTs7Ozs7SUF3QkYsK0NBR0UiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDYXJ0ZXNpYW4yIH0gZnJvbSAnLi4vYW5ndWxhci1jZXNpdW0vbW9kZWxzL2NhcnRlc2lhbjInO1xuaW1wb3J0IHsgQ2FydGVzaWFuMyB9IGZyb20gJy4uL2FuZ3VsYXItY2VzaXVtL21vZGVscy9jYXJ0ZXNpYW4zJztcbmltcG9ydCB7IEdlb1V0aWxzU2VydmljZSB9IGZyb20gJy4uL2FuZ3VsYXItY2VzaXVtL3NlcnZpY2VzL2dlby11dGlscy9nZW8tdXRpbHMuc2VydmljZSc7XG5pbXBvcnQgKiBhcyBoMzM3IGZyb20gJ2hlYXRtYXAuanMvYnVpbGQvaGVhdG1hcC5qcyc7XG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbi8vIENvbnNpZGVyIG1vdmluZyB0byBhIGRpZmZlcmVudCBwYWNrYWdlLlxuXG5pZiAoIWgzMzcpIHtcbiAgdGhyb3cgbmV3IEVycm9yKCdtdXN0IGluc3RhbGwgaGVhdG1hcC5qcy4gcGxlYXNlIGRvIG5wbSAtaSBoZWF0bWFwLmpzICcpO1xufVxuXG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVjdGFuZ2xlIHtcbiAgd2VzdDogbnVtYmVyO1xuICBzb3V0aDogbnVtYmVyO1xuICBlYXN0OiBudW1iZXI7XG4gIG5vcnRoOiBudW1iZXI7XG59XG5cblxuLyoqXG4gKiAgeDogbG9uXG4gKiAgeTogbGF0XG4gKiAgdmFsdWU6IHBvaW50IHZhbHVlXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgSGVhdFBvaW50RGF0YVBvaW50IHtcbiAgeDogbnVtYmVyO1xuICB5OiBudW1iZXI7XG4gIHZhbHVlOiBudW1iZXI7XG59XG5cbi8qKlxuICogICBtaW46ICB0aGUgbWluaW11bSBhbGxvd2VkIHZhbHVlIGZvciB0aGUgZGF0YSB2YWx1ZXNcbiAqICBtYXg6ICB0aGUgbWF4aW11bSBhbGxvd2VkIHZhbHVlIGZvciB0aGUgZGF0YSB2YWx1ZXNcbiAqICBoZWF0UG9pbnRzRGF0YTogYW4gYXJyYXkgb2YgZGF0YSBwb2ludHMgaW4gV0dTODQgY29vcmRpbmF0ZXMgYW5kIHZhbHVlcyBsaWtlIHsgeDpsb24sIHk6bGF0LCB2YWx1ZSlcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBIZWF0bWFwRGF0YVNldCB7XG4gIG1pbj86IG51bWJlcjtcbiAgbWF4PzogbnVtYmVyO1xuICBoZWF0UG9pbnRzRGF0YTogSGVhdFBvaW50RGF0YVBvaW50W107XG59XG5cbi8qKlxuICogYSBoZWF0bWFwLmpzIG9wdGlvbnMgb2JqZWN0IChzZWUgaHR0cDovL3d3dy5wYXRyaWNrLXdpZWQuYXQvc3RhdGljL2hlYXRtYXBqcy9kb2NzLmh0bWwjaDMzNy1jcmVhdGUpXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgSGVhdE1hcE9wdGlvbnMge1xuICBbcHJvcE5hbWU6IHN0cmluZ106IGFueTtcblxuICBncmFkaWVudD86IGFueTtcbiAgcmFkaXVzPzogbnVtYmVyO1xuICBvcGFjaXR5PzogbnVtYmVyO1xuICBtYXhPcGFjaXR5PzogbnVtYmVyO1xuICBtaW5PcGFjaXR5PzogbnVtYmVyO1xuICBibHVyPzogYW55O1xufVxuXG4vKipcbiAqIENyZWF0ZSBoZWF0bWFwIG1hdGVyaWFsIChDZXNpdW0uSW1hZ2VNYXRlcmlhbFByb3BlcnR5IHdpdGggaGVhdG1hcCBhcyB0aGUgaW1hZ2UpXG4gKiB3b3JrcyB3aXRoIGh0dHA6Ly93d3cucGF0cmljay13aWVkLmF0L3N0YXRpYy9oZWF0bWFwanMuIG11c3QgZG8gbnBtIC1pIGhlYXRtYXAuanNcbiAqIHVzYWdlOlxuICogYGBgXG4gKlxuIGNvbnN0IG1DcmVhdG9yID0gbmV3IENlc2l1bUhlYXRNYXBNYXRlcmlhbENyZWF0b3IoKTtcbiBjb25zdCBjb250YWluaW5nUmVjdCA9IENlc2l1bUhlYXRNYXBNYXRlcmlhbENyZWF0b3IuY2FsY0NpcmNsZUNvbnRhaW5pbmdSZWN0KHRoaXMuY2lyY2xlQ2VudGVyLCB0aGlzLmNpcmNsZVJhZGl1cyk7XG4gY29uc3QgdXNlckhlYXRtYXBPcHRpb25zID0ge1xuXHRcdFx0cmFkaXVzIDogMjAwMCxcblx0XHRcdG1pbk9wYWNpdHkgOiAwLFxuXHRcdFx0bWF4T3BhY2l0eSA6IDAuOSxcblx0XHR9IGFzIGFueTtcblxuIHRoaXMuY2lyY2xlSGVhdE1hcE1hdGVyaWFsID0gbUNyZWF0b3IuY3JlYXRlKGNvbnRhaW5pbmdSZWN0LCB7XG5cdFx0XHRoZWF0UG9pbnRzRGF0YSA6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHggOiAtMTAwLjAsXG5cdFx0XHRcdFx0eSA6IDI0LjAsXG5cdFx0XHRcdFx0dmFsdWUgOiA5NVxuXHRcdFx0XHR9XG5cdFx0XHRdLFxuXHRcdFx0bWluIDogMCxcblx0XHRcdG1heCA6IDEwMCxcblx0XHR9LCB1c2VySGVhdG1hcE9wdGlvbnMpO1xuICogYGBgXG4gKlxuICogaW5zcGlyZWQgYnkgaHR0cHM6Ly9naXRodWIuY29tL2RhbndpbGQvQ2VzaXVtSGVhdG1hcFxuICovXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgQ2VzaXVtSGVhdE1hcE1hdGVyaWFsQ3JlYXRvciB7XG5cblxuICBwcml2YXRlIHN0YXRpYyBjb250YWluZXJDYW52YXNDb3VudGVyID0gMDtcblxuICBoZWF0bWFwT3B0aW9uc0RlZmF1bHRzID0ge1xuICAgIG1pbkNhbnZhc1NpemU6IDcwMCwgICAgICAgICAgIC8vIG1pbmltdW0gc2l6ZSAoaW4gcGl4ZWxzKSBmb3IgdGhlIGhlYXRtYXAgY2FudmFzXG4gICAgbWF4Q2FudmFzU2l6ZTogMjAwMCwgICAgICAgICAgLy8gbWF4aW11bSBzaXplIChpbiBwaXhlbHMpIGZvciB0aGUgaGVhdG1hcCBjYW52YXNcbiAgICByYWRpdXNGYWN0b3I6IDYwLCAgICAgICAgICAgICAvLyBkYXRhIHBvaW50IHNpemUgZmFjdG9yIHVzZWQgaWYgbm8gcmFkaXVzIGlzIGdpdmVuXG4gICAgLy8gKHRoZSBncmVhdGVyIG9mIGhlaWdodCBhbmQgd2lkdGggZGl2aWRlZCBieSB0aGlzIG51bWJlciB5aWVsZHMgdGhlIHVzZWQgcmFkaXVzKVxuICAgIHNwYWNpbmdGYWN0b3I6IDEsICAgICAgICAgICAvLyBleHRyYSBzcGFjZSBhcm91bmQgdGhlIGJvcmRlcnMgKHBvaW50IHJhZGl1cyBtdWx0aXBsaWVkIGJ5IHRoaXMgbnVtYmVyIHlpZWxkcyB0aGUgc3BhY2luZylcbiAgICBtYXhPcGFjaXR5OiAwLjgsICAgICAgICAgICAgICAvLyB0aGUgbWF4aW11bSBvcGFjaXR5IHVzZWQgaWYgbm90IGdpdmVuIGluIHRoZSBoZWF0bWFwIG9wdGlvbnMgb2JqZWN0XG4gICAgbWluT3BhY2l0eTogMC4xLCAgICAgICAgICAgICAgLy8gdGhlIG1pbmltdW0gb3BhY2l0eSB1c2VkIGlmIG5vdCBnaXZlbiBpbiB0aGUgaGVhdG1hcCBvcHRpb25zIG9iamVjdFxuICAgIGJsdXI6IDAuODUsICAgICAgICAgICAgICAgICAgIC8vIHRoZSBibHVyIHVzZWQgaWYgbm90IGdpdmVuIGluIHRoZSBoZWF0bWFwIG9wdGlvbnMgb2JqZWN0XG4gICAgZ3JhZGllbnQ6IHsgICAgICAgICAgICAgICAgICAgLy8gdGhlIGdyYWRpZW50IHVzZWQgaWYgbm90IGdpdmVuIGluIHRoZSBoZWF0bWFwIG9wdGlvbnMgb2JqZWN0XG4gICAgICAnLjMnOiAnYmx1ZScsXG4gICAgICAnLjY1JzogJ3llbGxvdycsXG4gICAgICAnLjgnOiAnb3JhbmdlJyxcbiAgICAgICcuOTUnOiAncmVkJ1xuICAgIH0sXG4gIH07XG5cbiAgV01QID0gbmV3IENlc2l1bS5XZWJNZXJjYXRvclByb2plY3Rpb24oKTtcbiAgX3NwYWNpbmc6IG51bWJlcjtcbiAgd2lkdGg6IG51bWJlcjtcbiAgaGVpZ2h0OiBudW1iZXI7XG4gIF9tYm91bmRzOiBhbnk7XG4gIGJvdW5kczogYW55O1xuICBfZmFjdG9yOiBudW1iZXI7XG4gIF9yZWN0YW5nbGU6IFJlY3RhbmdsZTtcbiAgaGVhdG1hcDogYW55O1xuICBfeG9mZnNldDogYW55O1xuICBfeW9mZnNldDogYW55O1xuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gY2VudGVyIC0gQ2FydGVzaWFuM1xuICAgKiBAcGFyYW0gcmFkaXVzIC0gTWV0ZXJzXG4gICAqL1xuICBzdGF0aWMgY2FsY0NpcmNsZUNvbnRhaW5pbmdSZWN0KGNlbnRlcjogQ2FydGVzaWFuMywgcmFkaXVzOiBudW1iZXIpIHtcbiAgICByZXR1cm4gQ2VzaXVtSGVhdE1hcE1hdGVyaWFsQ3JlYXRvci5jYWxjRWxsaXBzZUNvbnRhaW5pbmdSZWN0KGNlbnRlciwgcmFkaXVzLCByYWRpdXMpO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSBjZW50ZXIgLSBDYXJ0ZXNpYW4zXG4gICAqIEBwYXJhbSBzZW1pTWlub3JBeGlzIC0gbWV0ZXJzXG4gICAqIEBwYXJhbSBzZW1pTWFqb3JBeGlzIC0gbWV0ZXJzXG4gICAqL1xuICBzdGF0aWMgY2FsY0VsbGlwc2VDb250YWluaW5nUmVjdChjZW50ZXI6IENhcnRlc2lhbjMsIHNlbWlNYWpvckF4aXM6IG51bWJlciwgc2VtaU1pbm9yQXhpczogbnVtYmVyKSB7XG4gICAgY29uc3QgdG9wID0gR2VvVXRpbHNTZXJ2aWNlLnBvaW50QnlMb2NhdGlvbkRpc3RhbmNlQW5kQXppbXV0aChcbiAgICAgIGNlbnRlcixcbiAgICAgIHNlbWlNaW5vckF4aXMsXG4gICAgICAwLFxuICAgICAgdHJ1ZVxuICAgICk7XG4gICAgY29uc3QgcmlnaHQgPSBHZW9VdGlsc1NlcnZpY2UucG9pbnRCeUxvY2F0aW9uRGlzdGFuY2VBbmRBemltdXRoKFxuICAgICAgY2VudGVyLFxuICAgICAgc2VtaU1ham9yQXhpcyxcbiAgICAgIE1hdGguUEkgLyAyLFxuICAgICAgdHJ1ZVxuICAgICk7XG4gICAgY29uc3QgYm90dG9tID0gR2VvVXRpbHNTZXJ2aWNlLnBvaW50QnlMb2NhdGlvbkRpc3RhbmNlQW5kQXppbXV0aChcbiAgICAgIGNlbnRlcixcbiAgICAgIHNlbWlNYWpvckF4aXMsXG4gICAgICBNYXRoLlBJLFxuICAgICAgdHJ1ZVxuICAgICk7XG4gICAgY29uc3QgbGVmdCA9IEdlb1V0aWxzU2VydmljZS5wb2ludEJ5TG9jYXRpb25EaXN0YW5jZUFuZEF6aW11dGgoXG4gICAgICBjZW50ZXIsXG4gICAgICBzZW1pTWFqb3JBeGlzLFxuICAgICAgTWF0aC5QSSAqIDEuNSxcbiAgICAgIHRydWVcbiAgICApO1xuXG4gICAgY29uc3QgZWxsaXBzZVBvaW50cyA9IFt0b3AsIHJpZ2h0LCBib3R0b20sIGxlZnRdO1xuICAgIHJldHVybiBDZXNpdW0uUmVjdGFuZ2xlLmZyb21DYXJ0ZXNpYW5BcnJheShlbGxpcHNlUG9pbnRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gcG9pbnRzIENhcnRlc2lhbjNcbiAgICovXG4gIHN0YXRpYyBjYWxjdWxhdGVDb250YWluaW5nUmVjdEZyb21Qb2ludHMocG9pbnRzOiBDYXJ0ZXNpYW4zW10pIHtcbiAgICByZXR1cm4gQ2VzaXVtLlJlY3RhbmdsZS5mcm9tQ2FydGVzaWFuQXJyYXkocG9pbnRzKTtcbiAgfVxuXG5cbiAgLyoqICBTZXQgYW4gYXJyYXkgb2YgaGVhdG1hcCBsb2NhdGlvbnNcbiAgICpcbiAgICogIG1pbjogIHRoZSBtaW5pbXVtIGFsbG93ZWQgdmFsdWUgZm9yIHRoZSBkYXRhIHZhbHVlc1xuICAgKiAgbWF4OiAgdGhlIG1heGltdW0gYWxsb3dlZCB2YWx1ZSBmb3IgdGhlIGRhdGEgdmFsdWVzXG4gICAqICBkYXRhOiBhbiBhcnJheSBvZiBkYXRhIHBvaW50cyBpbiBoZWF0bWFwIGNvb3JkaW5hdGVzIGFuZCB2YWx1ZXMgbGlrZSB7eCwgeSwgdmFsdWV9XG4gICAqL1xuICBzZXREYXRhKG1pbjogYW55LCBtYXg6IGFueSwgZGF0YTogYW55KSB7XG4gICAgaWYgKGRhdGEgJiYgZGF0YS5sZW5ndGggPiAwICYmIG1pbiAhPT0gbnVsbCAmJiBtaW4gIT09IGZhbHNlICYmIG1heCAhPT0gbnVsbCAmJiBtYXggIT09IGZhbHNlKSB7XG4gICAgICB0aGlzLmhlYXRtYXAuc2V0RGF0YSh7XG4gICAgICAgIG1pbjogbWluLFxuICAgICAgICBtYXg6IG1heCxcbiAgICAgICAgZGF0YTogZGF0YVxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8qKiAgU2V0IGFuIGFycmF5IG9mIFdHUzg0IGxvY2F0aW9uc1xuICAgKlxuICAgKiAgbWluOiAgdGhlIG1pbmltdW0gYWxsb3dlZCB2YWx1ZSBmb3IgdGhlIGRhdGEgdmFsdWVzXG4gICAqICBtYXg6ICB0aGUgbWF4aW11bSBhbGxvd2VkIHZhbHVlIGZvciB0aGUgZGF0YSB2YWx1ZXNcbiAgICogIGRhdGE6IGFuIGFycmF5IG9mIGRhdGEgcG9pbnRzIGluIFdHUzg0IGNvb3JkaW5hdGVzIGFuZCB2YWx1ZXMgbGlrZSB7IHg6bG9uLCB5OmxhdCwgdmFsdWUgfVxuICAgKi9cbiAgcHJpdmF0ZSBzZXRXR1M4NERhdGEobWluOiBhbnksIG1heDogYW55LCBkYXRhOiBhbnkpIHtcbiAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCA+IDAgJiYgbWluICE9PSBudWxsICYmIG1pbiAhPT0gZmFsc2UgJiYgbWF4ICE9PSBudWxsICYmIG1heCAhPT0gZmFsc2UpIHtcbiAgICAgIGNvbnN0IGNvbnZkYXRhID0gW107XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBncCA9IGRhdGFbaV07XG5cbiAgICAgICAgY29uc3QgaHAgPSB0aGlzLndnczg0UG9pbnRUb0hlYXRtYXBQb2ludChncCk7XG4gICAgICAgIGlmIChncC52YWx1ZSB8fCBncC52YWx1ZSA9PT0gMCkge1xuICAgICAgICAgIGhwLnZhbHVlID0gZ3AudmFsdWU7XG4gICAgICAgIH1cblxuICAgICAgICBjb252ZGF0YS5wdXNoKGhwKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMuc2V0RGF0YShtaW4sIG1heCwgY29udmRhdGEpO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8qKiAgQ29udmVydCBhIG1lcmNhdG9yIGxvY2F0aW9uIHRvIHRoZSBjb3JyZXNwb25kaW5nIGhlYXRtYXAgbG9jYXRpb25cbiAgICpcbiAgICogIHA6IGEgV0dTODQgbG9jYXRpb24gbGlrZSB7eDogbG9uLCB5OmxhdH1cbiAgICovXG4gIHByaXZhdGUgbWVyY2F0b3JQb2ludFRvSGVhdG1hcFBvaW50KHA6IENhcnRlc2lhbjIpIHtcbiAgICBjb25zdCBwbjogYW55ID0ge307XG5cbiAgICBwbi54ID0gTWF0aC5yb3VuZCgocC54IC0gdGhpcy5feG9mZnNldCkgLyB0aGlzLl9mYWN0b3IgKyB0aGlzLl9zcGFjaW5nKTtcbiAgICBwbi55ID0gTWF0aC5yb3VuZCgocC55IC0gdGhpcy5feW9mZnNldCkgLyB0aGlzLl9mYWN0b3IgKyB0aGlzLl9zcGFjaW5nKTtcbiAgICBwbi55ID0gdGhpcy5oZWlnaHQgLSBwbi55O1xuXG4gICAgcmV0dXJuIHBuO1xuICB9XG5cbiAgLyoqICBDb252ZXJ0IGEgV0dTODQgbG9jYXRpb24gdG8gdGhlIGNvcnJlc3BvbmRpbmcgaGVhdG1hcCBsb2NhdGlvblxuICAgKlxuICAgKiAgcDogYSBXR1M4NCBsb2NhdGlvbiBsaWtlIHt4OmxvbiwgeTpsYXR9XG4gICAqL1xuICBwcml2YXRlIHdnczg0UG9pbnRUb0hlYXRtYXBQb2ludCA9IGZ1bmN0aW9uIChwOiBDYXJ0ZXNpYW4yKSB7XG4gICAgcmV0dXJuIHRoaXMubWVyY2F0b3JQb2ludFRvSGVhdG1hcFBvaW50KHRoaXMud2dzODRUb01lcmNhdG9yKHApKTtcbiAgfTtcblxuXG4gIHByaXZhdGUgY3JlYXRlQ29udGFpbmVyKGhlaWdodDogbnVtYmVyLCB3aWR0aDogbnVtYmVyKSB7XG4gICAgY29uc3QgaWQgPSAnaGVhdG1hcCcgKyBDZXNpdW1IZWF0TWFwTWF0ZXJpYWxDcmVhdG9yLmNvbnRhaW5lckNhbnZhc0NvdW50ZXIrKztcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjb250YWluZXIuc2V0QXR0cmlidXRlKCdpZCcsIGlkKTtcbiAgICBjb250YWluZXIuc2V0QXR0cmlidXRlKCdzdHlsZScsICd3aWR0aDogJyArIHdpZHRoICsgJ3B4OyBoZWlnaHQ6ICcgKyBoZWlnaHQgKyAncHg7IG1hcmdpbjogMHB4OyBkaXNwbGF5OiBub25lOycpO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY29udGFpbmVyKTtcbiAgICByZXR1cm4ge2NvbnRhaW5lciwgaWR9O1xuICB9XG5cbiAgLyoqICBDb252ZXJ0IGEgV0dTODQgbG9jYXRpb24gaW50byBhIG1lcmNhdG9yIGxvY2F0aW9uXG4gICAqXG4gICAqICBwOiB0aGUgV0dTODQgbG9jYXRpb24gbGlrZSB7eDogbG9uLCB5OiBsYXR9XG4gICAqL1xuICBwcml2YXRlIHdnczg0VG9NZXJjYXRvcihwOiBDYXJ0ZXNpYW4yKSB7XG4gICAgY29uc3QgbXAgPSB0aGlzLldNUC5wcm9qZWN0KENlc2l1bS5DYXJ0b2dyYXBoaWMuZnJvbURlZ3JlZXMocC54LCBwLnkpKTtcbiAgICByZXR1cm4ge1xuICAgICAgeDogbXAueCxcbiAgICAgIHk6IG1wLnlcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSByYWQyZGVnID0gZnVuY3Rpb24gKHI6IG51bWJlcikge1xuICAgIGNvbnN0IGQgPSByIC8gKE1hdGguUEkgLyAxODAuMCk7XG4gICAgcmV0dXJuIGQ7XG4gIH07XG5cbiAgLyoqICBDb252ZXJ0IGEgV0dTODQgYm91bmRpbmcgYm94IGludG8gYSBtZXJjYXRvciBib3VuZGluZyBib3gqXG4gICAqICBiYjogdGhlIFdHUzg0IGJvdW5kaW5nIGJveCBsaWtlIHtub3J0aCwgZWFzdCwgc291dGgsIHdlc3R9XG4gICAqL1xuICBwcml2YXRlIHdnczg0VG9NZXJjYXRvckJCKGJiOiBhbnkpIHtcbiAgICAvLyBUT0RPIHZhbGlkYXRlIHJhZCBvciBkZWdcbiAgICBjb25zdCBzdyA9IHRoaXMuV01QLnByb2plY3QoQ2VzaXVtLkNhcnRvZ3JhcGhpYy5mcm9tUmFkaWFucyhiYi53ZXN0LCBiYi5zb3V0aCkpO1xuICAgIGNvbnN0IG5lID0gdGhpcy5XTVAucHJvamVjdChDZXNpdW0uQ2FydG9ncmFwaGljLmZyb21SYWRpYW5zKGJiLmVhc3QsIGJiLm5vcnRoKSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5vcnRoOiBuZS55LFxuICAgICAgZWFzdDogbmUueCxcbiAgICAgIHNvdXRoOiBzdy55LFxuICAgICAgd2VzdDogc3cueFxuICAgIH07XG4gIH1cblxuICAvKiogIENvbnZlcnQgYSBtZXJjYXRvciBib3VuZGluZyBib3ggaW50byBhIFdHUzg0IGJvdW5kaW5nIGJveFxuICAgKlxuICAgKiAgYmI6IHRoZSBtZXJjYXRvciBib3VuZGluZyBib3ggbGlrZSB7bm9ydGgsIGVhc3QsIHNvdXRoLCB3ZXN0fVxuICAgKi9cbiAgcHJpdmF0ZSBtZXJjYXRvclRvV2dzODRCQihiYjogYW55KSB7XG4gICAgY29uc3Qgc3cgPSB0aGlzLldNUC51bnByb2plY3QobmV3IENlc2l1bS5DYXJ0ZXNpYW4zKGJiLndlc3QsIGJiLnNvdXRoKSk7XG4gICAgY29uc3QgbmUgPSB0aGlzLldNUC51bnByb2plY3QobmV3IENlc2l1bS5DYXJ0ZXNpYW4zKGJiLmVhc3QsIGJiLm5vcnRoKSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5vcnRoOiB0aGlzLnJhZDJkZWcobmUubGF0aXR1ZGUpLFxuICAgICAgZWFzdDogdGhpcy5yYWQyZGVnKG5lLmxvbmdpdHVkZSksXG4gICAgICBzb3V0aDogdGhpcy5yYWQyZGVnKHN3LmxhdGl0dWRlKSxcbiAgICAgIHdlc3Q6IHRoaXMucmFkMmRlZyhzdy5sb25naXR1ZGUpXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0V2lkdGhBbmRIZWlnaHQobWJiOiBhbnkpIHtcbiAgICB0aGlzLndpZHRoID0gKChtYmIuZWFzdCA+IDAgJiYgbWJiLndlc3QgPCAwKSA/IG1iYi5lYXN0ICsgTWF0aC5hYnMobWJiLndlc3QpIDogTWF0aC5hYnMobWJiLmVhc3QgLSBtYmIud2VzdCkpO1xuICAgIHRoaXMuaGVpZ2h0ID0gKChtYmIubm9ydGggPiAwICYmIG1iYi5zb3V0aCA8IDApID8gbWJiLm5vcnRoICsgTWF0aC5hYnMobWJiLnNvdXRoKSA6IE1hdGguYWJzKG1iYi5ub3J0aCAtIG1iYi5zb3V0aCkpO1xuICAgIHRoaXMuX2ZhY3RvciA9IDE7XG5cbiAgICBpZiAodGhpcy53aWR0aCA+IHRoaXMuaGVpZ2h0ICYmIHRoaXMud2lkdGggPiB0aGlzLmhlYXRtYXBPcHRpb25zRGVmYXVsdHMubWF4Q2FudmFzU2l6ZSkge1xuICAgICAgdGhpcy5fZmFjdG9yID0gdGhpcy53aWR0aCAvIHRoaXMuaGVhdG1hcE9wdGlvbnNEZWZhdWx0cy5tYXhDYW52YXNTaXplO1xuXG4gICAgICBpZiAodGhpcy5oZWlnaHQgLyB0aGlzLl9mYWN0b3IgPCB0aGlzLmhlYXRtYXBPcHRpb25zRGVmYXVsdHMubWluQ2FudmFzU2l6ZSkge1xuICAgICAgICB0aGlzLl9mYWN0b3IgPSB0aGlzLmhlaWdodCAvIHRoaXMuaGVhdG1hcE9wdGlvbnNEZWZhdWx0cy5taW5DYW52YXNTaXplO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodGhpcy5oZWlnaHQgPiB0aGlzLndpZHRoICYmIHRoaXMuaGVpZ2h0ID4gdGhpcy5oZWF0bWFwT3B0aW9uc0RlZmF1bHRzLm1heENhbnZhc1NpemUpIHtcbiAgICAgIHRoaXMuX2ZhY3RvciA9IHRoaXMuaGVpZ2h0IC8gdGhpcy5oZWF0bWFwT3B0aW9uc0RlZmF1bHRzLm1heENhbnZhc1NpemU7XG5cbiAgICAgIGlmICh0aGlzLndpZHRoIC8gdGhpcy5fZmFjdG9yIDwgdGhpcy5oZWF0bWFwT3B0aW9uc0RlZmF1bHRzLm1pbkNhbnZhc1NpemUpIHtcbiAgICAgICAgdGhpcy5fZmFjdG9yID0gdGhpcy53aWR0aCAvIHRoaXMuaGVhdG1hcE9wdGlvbnNEZWZhdWx0cy5taW5DYW52YXNTaXplO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodGhpcy53aWR0aCA8IHRoaXMuaGVpZ2h0ICYmIHRoaXMud2lkdGggPCB0aGlzLmhlYXRtYXBPcHRpb25zRGVmYXVsdHMubWluQ2FudmFzU2l6ZSkge1xuICAgICAgdGhpcy5fZmFjdG9yID0gdGhpcy53aWR0aCAvIHRoaXMuaGVhdG1hcE9wdGlvbnNEZWZhdWx0cy5taW5DYW52YXNTaXplO1xuXG4gICAgICBpZiAodGhpcy5oZWlnaHQgLyB0aGlzLl9mYWN0b3IgPiB0aGlzLmhlYXRtYXBPcHRpb25zRGVmYXVsdHMubWF4Q2FudmFzU2l6ZSkge1xuICAgICAgICB0aGlzLl9mYWN0b3IgPSB0aGlzLmhlaWdodCAvIHRoaXMuaGVhdG1hcE9wdGlvbnNEZWZhdWx0cy5tYXhDYW52YXNTaXplO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodGhpcy5oZWlnaHQgPCB0aGlzLndpZHRoICYmIHRoaXMuaGVpZ2h0IDwgdGhpcy5oZWF0bWFwT3B0aW9uc0RlZmF1bHRzLm1pbkNhbnZhc1NpemUpIHtcbiAgICAgIHRoaXMuX2ZhY3RvciA9IHRoaXMuaGVpZ2h0IC8gdGhpcy5oZWF0bWFwT3B0aW9uc0RlZmF1bHRzLm1pbkNhbnZhc1NpemU7XG5cbiAgICAgIGlmICh0aGlzLndpZHRoIC8gdGhpcy5fZmFjdG9yID4gdGhpcy5oZWF0bWFwT3B0aW9uc0RlZmF1bHRzLm1heENhbnZhc1NpemUpIHtcbiAgICAgICAgdGhpcy5fZmFjdG9yID0gdGhpcy53aWR0aCAvIHRoaXMuaGVhdG1hcE9wdGlvbnNEZWZhdWx0cy5tYXhDYW52YXNTaXplO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMud2lkdGggPSB0aGlzLndpZHRoIC8gdGhpcy5fZmFjdG9yO1xuICAgIHRoaXMuaGVpZ2h0ID0gdGhpcy5oZWlnaHQgLyB0aGlzLl9mYWN0b3I7XG4gIH1cblxuICAvKipcbiAgICogY29udGFpbmluZ0JvdW5kaW5nUmVjdDogQ2VzaXVtLlJlY3RhbmdsZSBsaWtlIHtub3J0aCwgZWFzdCwgc291dGgsIHdlc3R9XG4gICAqIG1pbjogIHRoZSBtaW5pbXVtIGFsbG93ZWQgdmFsdWUgZm9yIHRoZSBkYXRhIHZhbHVlc1xuICAgKiBtYXg6ICB0aGUgbWF4aW11bSBhbGxvd2VkIHZhbHVlIGZvciB0aGUgZGF0YSB2YWx1ZXNcbiAgICogZGF0YXBvaW50OiB7eCx5LHZhbHVlfVxuICAgKiBoZWF0bWFwT3B0aW9uczogYSBoZWF0bWFwLmpzIG9wdGlvbnMgb2JqZWN0IChzZWUgaHR0cDovL3d3dy5wYXRyaWNrLXdpZWQuYXQvc3RhdGljL2hlYXRtYXBqcy9kb2NzLmh0bWwjaDMzNy1jcmVhdGUpXG4gICAqXG4gICAqL1xuICBwdWJsaWMgY3JlYXRlKGNvbnRhaW5pbmdCb3VuZGluZ1JlY3Q6IFJlY3RhbmdsZSwgaGVhdG1hcERhdGFTZXQ6IEhlYXRtYXBEYXRhU2V0LCBoZWF0bWFwT3B0aW9uczogSGVhdE1hcE9wdGlvbnMpIHtcbiAgICBjb25zdCB1c2VyQkIgPSBjb250YWluaW5nQm91bmRpbmdSZWN0O1xuICAgIGNvbnN0IHtoZWF0UG9pbnRzRGF0YSwgbWluID0gMCwgbWF4ID0gMTAwfSA9IGhlYXRtYXBEYXRhU2V0O1xuICAgIGNvbnN0IGZpbmFsSGVhdG1hcE9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmhlYXRtYXBPcHRpb25zRGVmYXVsdHMsIGhlYXRtYXBPcHRpb25zKTtcblxuICAgIHRoaXMuX21ib3VuZHMgPSB0aGlzLndnczg0VG9NZXJjYXRvckJCKHVzZXJCQik7XG4gICAgdGhpcy5zZXRXaWR0aEFuZEhlaWdodCh0aGlzLl9tYm91bmRzKTtcblxuICAgIGZpbmFsSGVhdG1hcE9wdGlvbnMucmFkaXVzID0gTWF0aC5yb3VuZCgoaGVhdG1hcE9wdGlvbnMucmFkaXVzKSA/XG4gICAgICBoZWF0bWFwT3B0aW9ucy5yYWRpdXMgOiAoKHRoaXMud2lkdGggPiB0aGlzLmhlaWdodCkgP1xuICAgICAgICB0aGlzLndpZHRoIC8gdGhpcy5oZWF0bWFwT3B0aW9uc0RlZmF1bHRzLnJhZGl1c0ZhY3RvciA6XG4gICAgICAgIHRoaXMuaGVpZ2h0IC8gdGhpcy5oZWF0bWFwT3B0aW9uc0RlZmF1bHRzLnJhZGl1c0ZhY3RvcikpO1xuICAgIHRoaXMuX3NwYWNpbmcgPSBmaW5hbEhlYXRtYXBPcHRpb25zLnJhZGl1cyAqIHRoaXMuaGVhdG1hcE9wdGlvbnNEZWZhdWx0cy5zcGFjaW5nRmFjdG9yO1xuICAgIHRoaXMuX3hvZmZzZXQgPSB0aGlzLl9tYm91bmRzLndlc3Q7XG4gICAgdGhpcy5feW9mZnNldCA9IHRoaXMuX21ib3VuZHMuc291dGg7XG5cbiAgICB0aGlzLndpZHRoID0gTWF0aC5yb3VuZCh0aGlzLndpZHRoICsgdGhpcy5fc3BhY2luZyAqIDIpO1xuICAgIHRoaXMuaGVpZ2h0ID0gTWF0aC5yb3VuZCh0aGlzLmhlaWdodCArIHRoaXMuX3NwYWNpbmcgKiAyKTtcblxuICAgIHRoaXMuX21ib3VuZHMud2VzdCAtPSB0aGlzLl9zcGFjaW5nICogdGhpcy5fZmFjdG9yO1xuICAgIHRoaXMuX21ib3VuZHMuZWFzdCArPSB0aGlzLl9zcGFjaW5nICogdGhpcy5fZmFjdG9yO1xuICAgIHRoaXMuX21ib3VuZHMuc291dGggLT0gdGhpcy5fc3BhY2luZyAqIHRoaXMuX2ZhY3RvcjtcbiAgICB0aGlzLl9tYm91bmRzLm5vcnRoICs9IHRoaXMuX3NwYWNpbmcgKiB0aGlzLl9mYWN0b3I7XG5cbiAgICB0aGlzLmJvdW5kcyA9IHRoaXMubWVyY2F0b3JUb1dnczg0QkIodGhpcy5fbWJvdW5kcyk7XG4gICAgdGhpcy5fcmVjdGFuZ2xlID0gQ2VzaXVtLlJlY3RhbmdsZS5mcm9tRGVncmVlcyh0aGlzLmJvdW5kcy53ZXN0LCB0aGlzLmJvdW5kcy5zb3V0aCwgdGhpcy5ib3VuZHMuZWFzdCwgdGhpcy5ib3VuZHMubm9ydGgpO1xuXG4gICAgY29uc3Qge2NvbnRhaW5lciwgaWR9ID0gdGhpcy5jcmVhdGVDb250YWluZXIodGhpcy5oZWlnaHQsIHRoaXMud2lkdGgpO1xuICAgIE9iamVjdC5hc3NpZ24oZmluYWxIZWF0bWFwT3B0aW9ucywge2NvbnRhaW5lcn0pO1xuXG4gICAgdGhpcy5oZWF0bWFwID0gaDMzNy5jcmVhdGUoZmluYWxIZWF0bWFwT3B0aW9ucyk7XG5cblxuICAgIHRoaXMuc2V0V0dTODREYXRhKDAsIDEwMCwgaGVhdFBvaW50c0RhdGEpO1xuICAgIGNvbnN0IGhlYXRNYXBDYW52YXMgPSB0aGlzLmhlYXRtYXAuX3JlbmRlcmVyLmNhbnZhcztcbiAgICBjb25zdCBoZWF0TWFwTWF0ZXJpYWwgPSBuZXcgQ2VzaXVtLkltYWdlTWF0ZXJpYWxQcm9wZXJ0eSh7XG4gICAgICBpbWFnZTogaGVhdE1hcENhbnZhcyxcbiAgICAgIHRyYW5zcGFyZW50OiB0cnVlLFxuICAgIH0pO1xuICAgIHRoaXMuc2V0Q2xlYXIoaGVhdE1hcE1hdGVyaWFsLCBpZCk7XG5cbiAgICByZXR1cm4gaGVhdE1hcE1hdGVyaWFsO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRDbGVhcihoZWF0TWFwTWF0ZXJpYWw6IGFueSwgaWQ6IHN0cmluZykge1xuICAgIGhlYXRNYXBNYXRlcmlhbC5jbGVhciA9ICgpID0+IHtcbiAgICAgIGNvbnN0IGVsZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7XG4gICAgICByZXR1cm4gZWxlbS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsZW0pO1xuICAgIH07XG4gIH1cbn1cblxuIl19